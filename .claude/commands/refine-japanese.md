# 日本語文書整形

## 概要

指定されたファイルの日本語を読みやすく整形する対話型コマンドです。

## ⚠️ 重要な注意事項

- **プロジェクト固有の用語集**や`.claude/CLAUDE.md`ファイルがある場合は**優先的に参照**してください
- 変更は**段階的に提示**し、ユーザーの確認を得てください
- 技術文書の場合、**専門用語の正確性を重視**してください
- **コードブロックおよびインラインコード（`...`）内のテキストは整形対象外**としてください

## 実行手順

### 1. 対象ファイルの確認と読み込み

- 引数で指定されたファイルパスを確認してください
- ファイルが存在することを確認し、内容を読み込んでください

エラーハンドリング：

1. **ファイル未指定**
   - エラー：「整形対象のファイルを指定してください」を出力し、処理を終了
2. **ファイル不存在**
   - エラー：「指定されたファイルが見つかりません」を出力し、処理を終了
3. **読み取り権限なし**
   - エラー：「ファイルの読み取り権限がありません」を出力し、処理を終了
4. **バイナリファイル**
   - エラー：「テキストファイルではありません」を出力し、処理を終了
5. **空ファイル**
   - 確認：「空のファイルです。続行しますか？(y/n)」を表示し、nの場合は処理を終了

### 2. 整形レベルの選択

整形の詳細度を選択してもらってください：

```text
整形レベルを選択してください：
1. ⭐ Basic (基本) - 句読点と文体の統一
2. ⭐⭐ Standard (標準) - 基本 + 読みやすさ改善
3. ⭐⭐⭐ Advanced (詳細) - 標準 + 文章構成の最適化

選択してください:
```

- ユーザーが番号を選択したら、対応する整形レベルを記録してください
- 1、2、3のいずれでもない値が入力された場合は「無効な番号です。再度入力してください」と再入力を促してください

### 3. 整形内容の分析と実施

選択された整形レベルに応じて、以下の観点で整形を実施してください：

#### Level 1 (Basic) - 基本整形

- [ ] 句読点の統一
  - 文末の句点「。」の確認
  - 読点「、」の適切な配置
  - 英文内の句読点との混在を整理

- [ ] 文体の統一
  - です・ます調 / である調の一貫性
  - 敬語表現の統一

- [ ] 半角・全角の統一
  - 英数字は半角
  - カタカナは全角
  - 記号の統一

#### Level 2 (Standard) - 標準整形

- [ ] Level 1の全項目

- [ ] 読みやすさの改善
  - 文字数が80文字以上の文を分割提案（句読点を含む、インラインコードを除く）
  - 箇条書きフォーマットの統一（「-」を標準とする）
  - 適切な改行位置の提案

#### Level 3 (Advanced) - 詳細整形

- [ ] Level 2の全項目

- [ ] 文章構成の最適化
  - 段落構成の改善提案
  - 見出しレベルの整合性確認
  - 論理的な流れの確認

- [ ] 表現の改善
  - 冗長な表現の簡潔化
  - あいまいな表現の明確化
  - 読み手を意識した表現への改善

### 4. 整形結果の提示

変更内容を分析し、以下の形式で整形結果を提示してください。
変更がない場合は「整形が必要な箇所はありませんでした」と報告してください：

```text
## 整形結果

[選択された整形レベルに応じて以下のいずれかを表示]
⭐ 整形モード: Basic (基本)
⭐⭐ 整形モード: Standard (標準)
⭐⭐⭐ 整形モード: Advanced (詳細)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

### 整形項目サマリー

- ✅ **完了項目**: [件数と概要] 例: 5件 - 句読点統一、文体統一
- 📝 **修正提案**: [件数と概要] 例: 3件 - 長文分割（80文字超）、改行位置
- 💡 **改善提案**: [件数と概要] 例: 2件 - 段落構成、表現の簡潔化

### 詳細な変更内容

#### 句読点・文体の統一

[具体的な変更箇所と理由]
例: 
- 「〜です」と「〜である」が混在 → 「〜です」に統一
- 文末に句点なし → 句点を追加

#### 読みやすさの改善（Standard以上）
[長文分割や箇条書きの改善]
例:
- 85文字の文 → 2文に分割を提案
- 箇条書きのマーカー統一（「・」→「-」）

#### 文章構成の改善（Advanced）
[段落構成や見出しレベルの改善提案]
例:
- 見出しレベルがh2からh4に飛んでいる箇所あり
- 1段落が300文字を超えている → 2段落に分割を提案
```

### 5. 変更の適用確認

整形結果を提示した後、以下のように適用確認を行ってください：

```text
整形結果を適用しますか？
1. すべて適用
2. 一部選択して適用
3. 適用しない

選択してください:
```

- **すべて適用**：ファイルに変更を書き込み
- **一部選択して適用**：各変更項目を個別に確認し、選択的に適用
- **適用しない**：処理を終了
