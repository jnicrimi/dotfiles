# 日本語文書整形

## 概要

指定されたファイルの日本語を読みやすく整形し、プロジェクト内の用語統一を確認する対話型コマンドです。

## 実行手順

### 1. 対象ファイルの確認と読み込み

- 引数で指定されたファイルパスを確認してください
- ファイルが存在することを確認し、内容を読み込んでください

エラーハンドリング：

1. ファイル未指定 → エラー：「整形対象のファイルを指定してください」を出力し、処理を終了
2. ファイル不存在 → エラー：「指定されたファイルが見つかりません」を出力し、処理を終了
3. 読み取り権限なし → エラー：「ファイルの読み取り権限がありません」を出力し、処理を終了
4. バイナリファイル → エラー：「テキストファイルではありません」を出力し、処理を終了
5. 空ファイル → 確認：「空のファイルです。続行しますか？(y/n)」を表示し、nの場合は処理を終了

### 2. 整形目的の選択

整形の目的を選択してもらってください：

```text
整形の目的を選択してください：
1. 👤 Human (人間向け) - 日本語として読みやすく整形
2. 🤖 Claude (AI向け) - Claude Codeが理解しやすく整形

選択してください:
```

- ユーザーが番号を選択したら、対応する整形目的を記録してください
- 1でも2でもない値が入力された場合は「無効な番号です。再度入力してください」と再入力を促してください

### 3. 整形レベルの選択（Human選択時のみ）

**Human (人間向け)** が選択された場合のみ、整形の詳細度を選択してもらってください：

```text
整形レベルを選択してください：
1. 🔧 Basic (基本) - 句読点と文体の統一
2. 🔧🔧 Standard (標準) - 基本 + 用語統一と読みやすさ改善
3. 🔧🔧🔧 Advanced (詳細) - 標準 + 文章構成の最適化

選択してください:
```

- ユーザーが番号を選択したら、対応する整形レベルを記録してください
- 1、2、3のいずれでもない値が入力された場合は「無効な番号です。再度入力してください」と再入力を促してください

**処理フローの分岐：**

- Human選択時：ステップ3（整形レベルの選択）を実行 → ステップ4へ進む
- Claude選択時：ステップ3をスキップ → ステップ4へ直接移行
  - ステップ5でClaude向け整形の観点のみを適用
  - ステップ6でClaude向けの結果形式を使用

### 4. 関連ファイルの分析（Human/Standard以上、またはClaude選択時）

以下の条件のいずれかを満たす場合、プロジェクト内の関連ファイルを検索し、使用されている用語を収集してください：

**関連ファイル分析の実行条件：**

| 整形目的 | 整形レベル | 関連ファイル分析 |
|---------|-----------|----------------|
| Human   | Basic     | スキップ       |
| Human   | Standard  | 実行           |
| Human   | Advanced  | 実行           |
| Claude  | -         | 実行           |

プロジェクト内のMarkdownファイル数をカウントし、5件以上の場合は関連ファイルから用語を収集してください（最大50件）。
ファイル数が4件以下の場合は、このステップをスキップしてください。

収集した情報から以下を把握してください：

- よく使用されるカタカナ表記と英語表記の頻度を収集
- プロジェクト固有の専門用語
- 文体の傾向（です・ます調 / である調）

### 5. 整形内容の分析と実施

選択された整形目的とレベルに応じて、以下の観点で整形を実施してください：

#### Level 1 (Basic) - 基本整形

- [ ] 句読点の統一
  - 文末の句点「。」の確認
  - 読点「、」の適切な配置
  - 英文内の句読点との混在を整理

- [ ] 文体の統一
  - です・ます調 / である調の一貫性
  - 敬語表現の統一

- [ ] 半角・全角の統一
  - 英数字は半角
  - カタカナは全角
  - 記号の統一

#### Level 2 (Standard) - 標準整形

- [ ] Level 1の全項目

- [ ] 用語の統一
  - カタカナ表記の統一（プロジェクト内の他ファイルと照合）
  - 専門用語の表記統一
  - 略語の統一（例：GitHub/Github、JS/JavaScript）
  - 用語統一の判断基準：
    - プロジェクト内で最も使用頻度が高い表記を採用
    - `.claude/CLAUDE.md`に定義がある場合はそれを優先
    - 例：
      - 「コミット」15回 vs 「commit」3回 → 「コミット」に統一
      - 「GitHub」10回 vs 「Github」2回 → 「GitHub」に統一

- [ ] 読みやすさの改善
  - 文字数が101文字以上の文を分割提案
  - 箇条書きフォーマットの統一
  - 適切な改行位置の提案

#### Level 3 (Advanced) - 詳細整形

- [ ] Level 2の全項目

- [ ] 文章構成の最適化
  - 段落構成の改善提案
  - 見出しレベルの整合性確認
  - 論理的な流れの確認

- [ ] 表現の改善
  - 冗長な表現の簡潔化
  - あいまいな表現の明確化
  - 読み手を意識した表現への改善

#### Claude向け整形（AI向け選択時）

Claude (AI向け) が選択された場合は、以下の観点で整形を実施してください：

- [ ] 構造化された文書形式
  - 明確なセクション見出しの設定
  - 番号付きリストや箇条書きの活用
  - 階層構造の明確化

- [ ] 技術情報の明確化
  - 技術用語への英語併記（例：「コミット（commit）」）
  - コマンド例の追加
  - ファイルパスやコードブロックの適切な配置

- [ ] 曖昧さの排除
  - 「など」を削除し、具体的な例示3つまでに限定
  - 「〜かもしれない」を条件分岐で明示（「Aの場合はX、Bの場合はY」の形式）
  - 手順の明確な番号付け
  - 条件分岐の明示（「もし〜なら」の明確化）

- [ ] 参照情報の整理
  - 関連ファイルやドキュメントへの明確な参照
  - 前提条件の明記
  - 期待される結果の明示

### 6. 整形結果の提示

変更内容を分析し、以下の形式で整形結果を提示してください：

#### Human向け整形の場合

```text
## 整形結果

[選択された整形レベルに応じて以下のいずれかを表示]
👤 整形目的: Human (人間向け)
🔧 整形モード: Basic (基本)
🔧🔧 整形モード: Standard (標準)
🔧🔧🔧 整形モード: Advanced (詳細)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

### 整形項目サマリー

- ✅ **完了項目**: [件数と概要] 例: 5件 - 句読点統一、文体統一
- 📝 **修正提案**: [件数と概要] 例: 3件 - 長文分割、用語統一
- 💡 **改善提案**: [件数と概要] 例: 2件 - 段落構成、表現の簡潔化

### 詳細な変更内容

#### 句読点・文体の統一

[具体的な変更箇所と理由]
例: 
- 「〜です」と「〜である」が混在 → 「〜です」に統一
- 文末に句点なし → 句点を追加

#### 用語の統一（Standard以上）
[プロジェクト内での使用状況と推奨表記]
例:
- 「コミット」: プロジェクト内で15回使用
- 「commit」: プロジェクト内で3回使用
→ 「コミット」に統一を推奨

#### 文章構成の改善（Advanced）
[段落構成や見出しレベルの改善提案]
例:
- 見出しレベルがh2からh4に飛んでいる箇所あり
- 1段落が300文字を超えている → 2段落に分割を提案
```

#### Claude向け整形の場合

```text
## 整形結果

🤖 整形目的: Claude (AI向け)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━

### 整形項目サマリー

- ✅ **構造化完了**: [件数と概要] 例: 8件 - セクション見出し、番号付きリスト
- 📝 **技術情報追加**: [件数と概要] 例: 5件 - 英語併記、コマンド例
- 💡 **明確化提案**: [件数と概要] 例: 3件 - 曖昧表現の具体化、条件分岐の明示

### 詳細な変更内容

#### 構造化された文書形式
[具体的な変更箇所]
例:
- フラットな説明文 → 番号付き手順に変更
- 長い段落 → 箇条書きリストに分割

#### 技術情報の明確化
[追加された技術情報]
例:
- 「設定ファイル」→「設定ファイル（.claude/settings.json）」
- 「コマンドを実行」→「`npm run test` コマンドを実行」

#### 曖昧さの排除
[明確化された表現]
例:
- 「いくつかの方法があります」→「以下の3つの方法があります：」
- 「〜かもしれません」→「〜の場合は〜、そうでない場合は〜」
```

### 7. 変更の適用確認

整形結果を提示した後、以下のように適用確認を行ってください：

```text
整形結果を適用しますか？
1. すべて適用
2. 一部選択して適用
3. 適用しない

選択してください:
```

- **すべて適用**：ファイルに変更を書き込み
- **一部選択して適用**：各変更項目を個別に確認し、選択的に適用
- **適用しない**：処理を終了

## 注意事項

- プロジェクト固有の用語集や`.claude/CLAUDE.md`ファイルがある場合は優先的に参照してください
- 変更は段階的に提示し、ユーザーの確認を得てください
- 技術文書の場合、専門用語の正確性を重視してください
- コードブロック内のテキストは整形対象外としてください
