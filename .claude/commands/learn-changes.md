# learn-changes

## 概要

ローカルブランチ間の差分を分析し、今後の開発に必要な変更内容を把握する

## 実行手順

### 1. 現在の状態確認

```bash
# 現在のブランチを確認
git branch --show-current

# 未コミットの変更を確認
git status --short
```

### 2. ベースブランチの選択

```bash
# ローカルブランチ一覧を取得
git branch --format='%(refname:short)'
```

#### 比較可能なブランチが存在しない場合

「比較可能なブランチがありません」と出力して処理を終了

#### 比較可能なブランチが存在する場合

取得したローカルブランチ一覧から、選択肢を表示する際にカレントブランチを除外

```text
════════════════════════════════════════
🔀 ベースブランチの選択
════════════════════════════════════════

1. branch-name-1
2. branch-name-2
3. branch-name-3

────────────────────────────────────────

▶ 選択してください
```

ユーザーが番号を選択したら以下を実行

- 有効な番号が選択された場合
  - 選択されたベースブランチを記録
- 無効な番号が選択された場合
  - 「無効な番号です。もう一度番号を選択してください」と再入力を促す

### 3. 差分の取得と分析

#### 3.1 差分の取得

選択されたベースブランチとの差分を取得

```bash
# 差分の統計情報を取得
git diff ${selected_branch}...HEAD --stat

# 変更されたファイル一覧を取得
git diff ${selected_branch}...HEAD --name-status

# 未コミットの変更を確認
git diff --staged
git diff

# 実際の差分内容を取得して分析
git diff ${selected_branch}...HEAD
```

- 変更がない場合
  - 「変更内容がありません」を出力し、処理を終了

#### 3.2 差分の分析

収集した差分を整理して、以下の項目に分類

- 追加された機能
- 変更された機能
- 削除された機能

### 4. 変更要約の生成

変更内容を開発者が理解しやすい形式にまとめる

#### 出力ルール

- テンプレートの内容のみを出力する
- テキスト形式で出力する（```text```ブロックで囲む）
- テンプレート以外の説明や補足は追加しない
- `{{! ... }}` で囲まれた例文は出力しない（内部参照用）
- `[...]` のプレースホルダはAIが適切な内容を生成して置き換える
- 変更を機能単位や関連性でグループ化する
- 簡潔で分かりやすい表現を使用する

#### 出力テンプレート

```text
════════════════════════════════════════
📋 変更要約
════════════════════════════════════════

🏷️ [変更カテゴリ]

◆ [具体的な変更内容]
  • [関連ファイルパス]
  • [関連ファイルパス]

◆ [具体的な変更内容]
  • [関連ファイルパス]

────────────────────────────────────────

🏷️ [変更カテゴリ]

◆ [具体的な変更内容]
  • [関連ファイルパス]

◆ [具体的な変更内容]
  • [関連ファイルパス]
```

#### 出力例

```text
════════════════════════════════════════
📋 変更要約
════════════════════════════════════════

🏷️ [機能追加]

◆ usersテーブルにphoneカラムを追加
  • db/schema.rb
  • db/migrate/20240101_add_phone_to_users.rb

◆ Userモデルにphone属性を追加
  • app/models/user.rb

────────────────────────────────────────

🏷️ [機能改善]

◆ メール再送機能を実装
  • app/controllers/password_resets_controller.rb
  • app/mailers/user_mailer.rb

◆ レート制限を追加（1分間に1回まで）
  • app/models/password_reset_request.rb
  • config/initializers/rate_limit.rb
